<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Entradas MOVOM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f3e9ff;
    margin:0;
    padding:20px;
}
header{
    background: linear-gradient(90deg, #9b4dff, #00c2ff);
    padding:20px;
    text-align:center;
    color:white;
    font-size:24px;
    font-weight:bold;
}
.container{
    max-width:1100px;
    margin:30px auto;
    background:white;
    padding:20px;
    border-radius:12px;
}
table{
    width:100%;
    border-collapse:collapse;
}
th{
    background:#9b4dff;
    color:white;
    padding:10px;
}
td{
    border:1px solid #ddd;
    padding:6px;
    text-align:center;
}
input, select{
    width:95%;
    padding:6px;
    border-radius:6px;
    border:1px solid #ccc;
}
button{
    margin-top:20px;
    padding:12px 18px;
    background:#9b4dff;
    color:white;
    border:none;
    border-radius:8px;
    font-size:16px;
    cursor:pointer;
}
button:hover{
    background:#7d36d6;
}
.status{
    text-align:center;
    margin-top:10px;
    font-size:14px;
    color:#666;
}
</style>
</head>

<body>

<header>Entradas MOVOM</header>

<div class="container">
<table>
<thead>
<tr>
    <th>Data</th>
    <th>Nome</th>
    <th>Valor</th>
    <th>Pagamento</th>
</tr>
</thead>
<tbody id="tableBody"></tbody>
</table>

<button onclick="salvar()">Salvar</button>
<div class="status" id="status">Sincronizandoâ€¦</div>
</div>

<script type="module">
/* ðŸ”¹ FIREBASE */
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

/* ðŸ”¹ CONFIG FIREBASE */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "SEU_PROJETO.firebaseapp.com",
  databaseURL: "https://SEU_PROJETO-default-rtdb.firebaseio.com",
  projectId: "SEU_PROJETO",
  storageBucket: "SEU_PROJETO.appspot.com",
  messagingSenderId: "SEU_ID",
  appId: "SEU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const entradasRef = ref(db, "entradas");

/* ðŸ”¹ TABELA */
const tbody = document.getElementById("tableBody");
const statusEl = document.getElementById("status");

/* ðŸ”¹ CRIAR 31 LINHAS */
for(let i=0;i<31;i++){
    const tr = document.createElement("tr");
    tr.innerHTML = `
        <td><input type="date"></td>
        <td><input type="text" placeholder="Nome"></td>
        <td><input type="number" step="0.01"></td>
        <td>
            <select>
                <option>Pix</option>
                <option>CrÃ©dito</option>
                <option>DÃ©bito</option>
                <option>Dinheiro</option>
            </select>
        </td>
    `;
    tbody.appendChild(tr);
}

/* ðŸ”¹ MONTAR DADOS */
function montarDados(){
    const dados = [];
    document.querySelectorAll("#tableBody tr").forEach(tr=>{
        const inputs = tr.querySelectorAll("input, select");
        if(inputs[1].value || inputs[2].value){
            dados.push({
                data: inputs[0].value,
                nome: inputs[1].value,
                valor: parseFloat(inputs[2].value) || 0,
                pagamento: inputs[3].value
            });
        }
    });
    return dados;
}

/* ðŸ”¹ APLICAR DADOS NA TELA */
function aplicarDados(dados){
    document.querySelectorAll("#tableBody tr").forEach((tr,i)=>{
        if(dados[i]){
            const inputs = tr.querySelectorAll("input, select");
            inputs[0].value = dados[i].data || "";
            inputs[1].value = dados[i].nome || "";
            inputs[2].value = dados[i].valor || "";
            inputs[3].value = dados[i].pagamento || "Pix";
        }
    });
}

/* ðŸ”¹ SALVAR */
window.salvar = function(){
    const dados = montarDados();
    localStorage.setItem("entradas_movom", JSON.stringify(dados));
    set(entradasRef, dados);
    statusEl.textContent = "Salvo localmente e no Firebase";
};

/* ðŸ”¹ AUTO-SAVE (sem travar digitaÃ§Ã£o) */
let timer = null;
document.addEventListener("input", ()=>{
    clearTimeout(timer);
    timer = setTimeout(()=>{
        salvar();
    }, 500);
});

/* ðŸ”¹ CARREGAR LOCALSTORAGE PRIMEIRO */
const local = localStorage.getItem("entradas_movom");
if(local){
    aplicarDados(JSON.parse(local));
    statusEl.textContent = "Dados carregados do dispositivo";
}

/* ðŸ”¹ SINCRONIZAÃ‡ÃƒO FIREBASE */
onValue(entradasRef, snapshot=>{
    const dados = snapshot.val();
    if(!dados) return;
    aplicarDados(dados);
    localStorage.setItem("entradas_movom", JSON.stringify(dados));
    statusEl.textContent = "Sincronizado com Firebase";
});
</script>

</body>
</html>
