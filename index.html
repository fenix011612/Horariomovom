<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agenda Ale - Movom</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
  --lilas:#6a5acd;
  --ciano:#4fc3f7;
  --bg:#f7f5ff;
}
body{
  font-family:Poppins,Arial,sans-serif;
  background:var(--bg);
  padding:20px;
}
h2,h3{
  text-align:center;
  color:var(--lilas);
}
select{
  padding:8px 12px;
  border-radius:8px;
}
table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  margin-bottom:30px;
  border-radius:8px;
  overflow:hidden;
}
th{
  background:linear-gradient(90deg,var(--lilas),var(--ciano));
  color:#fff;
  padding:10px;
}
td{
  padding:10px;
  border-bottom:1px solid #eee;
  vertical-align:top;
}
.hora{
  width:80px;
  text-align:center;
  font-weight:600;
}
.aluno{
  display:flex;
  gap:6px;
  margin-bottom:6px;
}
.aluno input{
  flex:1;
  padding:6px;
  border-radius:6px;
  border:1px solid #ddd;
}
button{
  border:none;
  border-radius:6px;
  padding:6px 10px;
  cursor:pointer;
}
.add{ background:var(--ciano); color:#fff; }
.rem{ background:#ff6b8a; color:#fff; }
</style>
</head>

<body>

<h2>Agenda da Instrutora Ale</h2>

<div style="text-align:center;margin-bottom:20px;">
  <select id="filtro">
    <option value="todos">Todos</option>
    <option>Segunda-feira</option>
    <option>Terça-feira</option>
    <option>Quarta-feira</option>
    <option>Quinta-feira</option>
    <option>Sexta-feira</option>
    <option>Sábado</option>
  </select>
</div>

<div id="container"></div>

<script>
// ================= FIREBASE =================
const firebaseConfig = {
  apiKey: "AIzaSyASKbZ204Yls9IU3HenHTsHwqgbpotUga0",
  authDomain: "horariomovom.firebaseapp.com",
  databaseURL: "https://horariomovom-default-rtdb.firebaseio.com",
  projectId: "horariomovom",
  storageBucket: "horariomovom.firebasestorage.app",
  messagingSenderId: "827903999846",
  appId: "1:827903999846:web:e2495e75cc0f8b4ad852a7"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================= HORÁRIOS =================
function gerarHoras(inicio,fim){
  const h=[];
  for(let i=inicio;i<fim;i++){
    h.push(`${String(i).padStart(2,"0")}:00`);
  }
  return h;
}

const semana = [
  { dia:"Segunda-feira", horas:gerarHoras(7,19) },
  { dia:"Terça-feira",  horas:gerarHoras(7,19) },
  { dia:"Quarta-feira", horas:gerarHoras(7,19) },
  { dia:"Quinta-feira", horas:gerarHoras(7,19) },
  { dia:"Sexta-feira",  horas:gerarHoras(7,18) },
  { dia:"Sábado",       horas:gerarHoras(7,11) }
];

const container = document.getElementById("container");
const filtro = document.getElementById("filtro");

// ================= COMPONENTES =================
function criarAluno(nome){
  const div=document.createElement("div");
  div.className="aluno";
  div.innerHTML=`
    <input value="${nome||""}" placeholder="Nome do aluno">
    <button class="rem">X</button>
  `;
  div.querySelector("input").oninput=salvar;
  div.querySelector("button").onclick=()=>{div.remove();salvar();};
  return div;
}

function criarLinha(hora,salvo){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td class="hora">${hora}</td>
    <td>
      <strong>Ale</strong>
      <div class="alunos"></div>
      <button class="add">+ Aluno</button>
    </td>
  `;
  const box=tr.querySelector(".alunos");
  (salvo?.alunos||[]).forEach(a=>box.appendChild(criarAluno(a)));
  tr.querySelector(".add").onclick=()=>{
    box.appendChild(criarAluno(""));
    salvar();
  };
  return tr;
}

// ================= SALVAR =================
function salvar(){
  const dados=[];
  document.querySelectorAll("table").forEach(t=>{
    const dia=t.dataset.dia;
    const linhas=[];
    t.querySelectorAll("tbody tr").forEach(tr=>{
      linhas.push({
        hora: tr.querySelector(".hora").innerText,
        alunos: [...tr.querySelectorAll("input")].map(i=>i.value)
      });
    });
    dados.push({dia,linhas});
  });
  db.ref("agendaAle").set(dados);
}

// ================= TEMPO REAL =================
db.ref("agendaAle").on("value",snap=>{
  const dados=snap.val();
  container.innerHTML="";
  semana.forEach(d=>{
    const h3=document.createElement("h3");
    h3.innerText=d.dia;

    const table=document.createElement("table");
    table.dataset.dia=d.dia;
    table.innerHTML="<thead><tr><th>Hora</th><th>Instrutora</th></tr></thead>";

    const tbody=document.createElement("tbody");
    const salvo=dados?.find(x=>x.dia===d.dia);

    d.horas.forEach(h=>{
      const linhaSalva=salvo?.linhas?.find(l=>l.hora===h);
      tbody.appendChild(criarLinha(h,linhaSalva));
    });

    table.appendChild(tbody);
    container.appendChild(h3);
    container.appendChild(table);
  });
  filtrar();
});

// ================= FILTRO =================
function filtrar(){
  document.querySelectorAll("h3,table").forEach(el=>{
    if(filtro.value==="todos"){
      el.style.display="";
    }else{
      if(el.tagName==="H3"){
        el.style.display=el.innerText===filtro.value?"":"none";
      }else{
        el.style.display=el.dataset.dia===filtro.value?"":"none";
      }
    }
  });
}
filtro.onchange=filtrar;
</script>

</body>
</html>
