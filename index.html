<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Grade de Hor√°rios Movom</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- ‚ö†Ô∏è SEU CSS ORIGINAL (inalterado) -->
<style>
/* ... SEU CSS EXATAMENTE COMO ESTAVA ... */
</style>
</head>
<body>

<div class="container-card">
    <div class="controls">
        <label for="diaSemana">Selecionar dia:</label>
        <select id="diaSemana">
            <option value="todos">Todos</option>
            <option>Segunda-feira</option>
            <option>Ter√ßa-feira</option>
            <option>Quarta-feira</option>
            <option>Quinta-feira</option>
            <option>Sexta-feira</option>
            <option>S√°bado</option>
        </select>
    </div>

    <div class="status" id="status">Conectando‚Ä¶</div>
    <div id="container"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

/* üîπ FIREBASE CONFIG (SEU) */
const firebaseConfig = {
  apiKey: "SUA_API_KEY",
  authDomain: "horariomovom.firebaseapp.com",
  databaseURL: "https://horariomovom-default-rtdb.firebaseio.com",
  projectId: "horariomovom",
  storageBucket: "horariomovom.appspot.com",
  messagingSenderId: "827903999846",
  appId: "1:827903999846:web:e2495e75cc0f8b4ad852a7"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const rootRef = ref(db, "grades/movom");

/* =========================
   CONTROLE DE SINCRONIZA√á√ÉO
========================= */
let isRemote = false;

/* =========================
   LOCALSTORAGE
========================= */
function salvarLocal(data){
    localStorage.setItem("movom_grade", JSON.stringify(data));
}
function carregarLocal(){
    const d = localStorage.getItem("movom_grade");
    return d ? JSON.parse(d) : null;
}

/* =========================
   SEU C√ìDIGO ORIGINAL
   (fun√ß√µes gerarHorarios, criarTabelaCompleta,
    montarModelo, aplicarModeloNoDOM, etc)
   ‚ö†Ô∏è N√ÉO ALTERADAS
========================= */

/* =========================
   SALVAR
========================= */
function salvar(){
    if(isRemote) return;
    const data = montarModelo();
    salvarLocal(data);
    set(rootRef, data);
    document.getElementById("status").textContent = "Salvo";
}

/* =========================
   AUTO SAVE (SEM TRAVAR)
========================= */
let timer = null;
document.addEventListener("input", ()=>{
    clearTimeout(timer);
    timer = setTimeout(salvar, 500);
});

/* =========================
   FIREBASE ‚Üí TELA
========================= */
onValue(rootRef, snap=>{
    const data = snap.val();
    if(!data) return;
    isRemote = true;
    aplicarModeloNoDOM(data);
    salvarLocal(data);
    isRemote = false;
    document.getElementById("status").textContent = "Sincronizado";
});

/* =========================
   INICIALIZA√á√ÉO
========================= */
criarTabelaCompleta();

const local = carregarLocal();
if(local){
    aplicarModeloNoDOM(local);
    set(rootRef, local);
    document.getElementById("status").textContent = "Dados restaurados";
}
</script>

</body>
</html>
