<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Grade de Horários Movom</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
:root{
    --lilas:#6a5acd;
    --ciano:#4fc3f7;
    --bg:#f7f5ff;
    --card:#ffffff;
}
body{
    font-family:Poppins, Arial, sans-serif;
    background:var(--bg);
    padding:20px;
}
h2,h3{ text-align:center; color:var(--lilas); }
.controls{
    display:flex; justify-content:center; gap:12px; margin-bottom:16px;
}
select{ padding:8px; border-radius:8px; }
.container-card{
    background:#fff; border-radius:12px; padding:14px;
    box-shadow:0 6px 20px rgba(0,0,0,.06);
}
table{ width:100%; border-collapse:collapse; margin-bottom:24px; }
thead th{
    background:linear-gradient(90deg,var(--lilas),var(--ciano));
    color:#fff; padding:10px;
}
td{ padding:10px; border-bottom:1px solid #eee; }
.horario-cell{ width:90px; text-align:center; font-weight:600; }
.instrutor-box{
    border-left:4px solid var(--lilas);
    padding:8px; border-radius:6px; background:#fff;
}
.instrutor-box + .instrutor-box{ border-left-color:var(--ciano); }
.alunos-box{ display:flex; flex-direction:column; gap:6px; }
.aluno-row{ display:flex; gap:6px; }
.aluno-row input{ flex:1; padding:6px; }
.btn{ padding:6px 10px; border-radius:8px; border:none; cursor:pointer; }
.btn-add{ background:var(--ciano); color:#fff; }
.btn-remove,.btn-apagar{ background:#ff6b8a; color:#fff; }
.small{ font-size:12px; }
</style>
</head>

<body>

<div class="container-card">
    <div class="controls">
        <select id="diaSemana">
            <option value="todos">Todos</option>
            <option>Segunda-feira</option>
            <option>Terça-feira</option>
            <option>Quarta-feira</option>
            <option>Quinta-feira</option>
            <option>Sexta-feira</option>
            <option>Sábado</option>
        </select>
    </div>

    <h2>Grade de Horários Movom</h2>
    <div id="container"></div>
</div>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
  apiKey: "AIzaSyASKbZ204Yls9IU3HenHTsHwqgbpotUga0",
  authDomain: "horariomovom.firebaseapp.com",
  databaseURL: "https://horariomovom-default-rtdb.firebaseio.com",
  projectId: "horariomovom"
});
const db = firebase.database().ref("gradeHorarios");

// ================= CONFIG =================
const MAX_ALUNOS = 5;
const container = document.getElementById("container");
const selectDia = document.getElementById("diaSemana");

function gerarHorarios(i,f){
    return Array.from({length:f-i},(_,k)=>`${String(k+i).padStart(2,'0')}:00`);
}

const semana = [
 {dia:"Segunda-feira",horarios:gerarHorarios(7,20)},
 {dia:"Terça-feira",horarios:gerarHorarios(7,20)},
 {dia:"Quarta-feira",horarios:gerarHorarios(7,20)},
 {dia:"Quinta-feira",horarios:gerarHorarios(7,20)},
 {dia:"Sexta-feira",horarios:gerarHorarios(7,19)},
 {dia:"Sábado",horarios:gerarHorarios(7,12)}
];

// ================= SALVAR =================
function salvar(){
    const data = {};
    document.querySelectorAll("table").forEach(t=>{
        const dia=t.dataset.dia;
        data[dia]=[];
        t.querySelectorAll("tbody tr").forEach(tr=>{
            const horario=tr.querySelector(".horario-cell").textContent;
            const instr1=tr.querySelector(".instrutor1 input").value;
            const instr2=tr.querySelector(".instrutor2 input").value;
            const alunos1=[...tr.querySelectorAll(".instrutor1 .aluno-row input")].map(i=>i.value);
            const alunos2=[...tr.querySelectorAll(".instrutor2 .aluno-row input")].map(i=>i.value);
            data[dia].push({horario,instr1,instr2,alunos1,alunos2});
        });
    });
    db.set(data);
}

// ================= UI =================
function alunoRow(v){
    const d=document.createElement("div");
    d.className="aluno-row";
    d.innerHTML=`<input value="${v||""}"><button class="btn btn-remove small">X</button>`;
    d.querySelector("input").oninput=salvar;
    d.querySelector("button").onclick=()=>{d.remove();salvar();}
    return d;
}

function coluna(instr,alunos){
    const b=document.createElement("div");
    b.className="instrutor-box";
    b.innerHTML=`<input value="${instr||""}">`;
    const a=document.createElement("div"); a.className="alunos-box";
    (alunos||[]).forEach(x=>a.appendChild(alunoRow(x)));
    b.appendChild(a);
    b.querySelector("input").oninput=salvar;
    return {b,a};
}

function linha(h,d){
    const tr=document.createElement("tr");
    tr.innerHTML=`<td class="horario-cell">${h}</td>
    <td class="instrutor1"></td><td class="instrutor2"></td>
    <td><button class="btn btn-apagar small">Apagar</button></td>`;
    const i1=coluna(d?.instr1,d?.alunos1);
    const i2=coluna(d?.instr2,d?.alunos2);
    tr.children[1].append(i1.b,addBtn(i1.a));
    tr.children[2].append(i2.b,addBtn(i2.a));
    tr.querySelector(".btn-apagar").onclick=()=>{tr.remove();salvar();}
    return tr;
}

function addBtn(box){
    const b=document.createElement("button");
    b.className="btn btn-add small"; b.textContent="+ Aluno";
    b.onclick=()=>{
        if(box.children.length>=MAX_ALUNOS) return alert("Limite 5 alunos");
        box.appendChild(alunoRow(""));
        salvar();
    };
    return b;
}

function montar(data={}){
    container.innerHTML="";
    semana.forEach(s=>{
        container.innerHTML+=`<h3>${s.dia}</h3>`;
        const t=document.createElement("table");
        t.dataset.dia=s.dia;
        t.innerHTML=`<thead><tr><th>Horário</th><th>Instrutor 1</th><th>Instrutor 2</th><th>Ações</th></tr></thead>`;
        const tb=document.createElement("tbody");
        s.horarios.forEach(h=>{
            tb.appendChild(linha(h,data[s.dia]?.find(x=>x.horario===h)));
        });
        t.appendChild(tb);
        container.appendChild(t);
    });
}

// ================= TEMPO REAL =================
db.on("value",snap=>montar(snap.val()||{}));

selectDia.onchange=()=>{
 document.querySelectorAll("h3,table").forEach(e=>{
   if(selectDia.value==="todos") e.style.display="";
   else e.style.display=(e.tagName==="H3"?e.textContent:e.previousElementSibling.textContent)===selectDia.value?"":"none";
 });
};
</script>
</body>
</html>
